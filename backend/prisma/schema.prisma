generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model auditoria {
  id_auditoria       BigInt    @id @default(autoincrement())
  id_usuario         Int?
  fecha_hora         DateTime? @default(now()) @db.Timestamp(6)
  accion             String    @db.VarChar(100)
  modulo             String    @db.VarChar(100)
  registro_afectado  String?   @db.VarChar(255)
  valores_anteriores Json?
  valores_nuevos     Json?
  ip_origen          String?   @db.VarChar(45)
  usuario            usuario?  @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_hora(sort: Desc)], map: "idx_auditoria_fecha")
  @@index([modulo], map: "idx_auditoria_modulo")
  @@index([id_usuario], map: "idx_auditoria_usuario")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model client {
  id               Int             @id @default(autoincrement()) @map("id_cliente")
  trade_name       String          @map("nombre_comercial") @db.VarChar(200)
  legal_name       String          @map("razon_social") @db.VarChar(200)
  tax_id           String          @unique @map("rif") @db.VarChar(20)
  address          String?         @map("direccion")
  phone            String?         @map("telefono") @db.VarChar(50)
  email            String?         @db.VarChar(100)
  status           client_status?  @default(ACTIVE) @map("estado")
  registration_date DateTime?      @default(now()) @map("fecha_registro") @db.Timestamp(6)
  created_at       DateTime?       @default(now()) @db.Timestamp(6)
  updated_at       DateTime?       @default(now()) @db.Timestamp(6)
  equipment        equipo[]
  invoices         factura[]
  service_orders   ods[]
  quotes           proforma[]
  contacts         client_contact[]

  @@map("cliente")
}

model client_contact {
  id           Int       @id @default(autoincrement()) @map("id_contacto")
  client_id    Int       @map("id_cliente")
  first_name   String    @map("nombre") @db.VarChar(100)
  last_name    String?   @map("apellido") @db.VarChar(100)
  position     String?   @map("cargo") @db.VarChar(100)
  phone        String?   @map("telefono") @db.VarChar(50)
  email        String?   @db.VarChar(100)
  is_primary   Boolean?  @default(false) @map("es_principal")
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  client       client    @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([client_id], map: "idx_cliente_contacto_cliente")
  @@map("cliente_contacto")
}

model end_customer {
  id               Int         @id @default(autoincrement()) @map("id_cliente_final")
  name             String      @map("nombre") @db.VarChar(200)
  industry_sector  String?     @map("sector_industria") @db.VarChar(100)
  notes            String?     @map("observaciones")
  created_at       DateTime?   @default(now()) @db.Timestamp(6)
  updated_at       DateTime?   @default(now()) @db.Timestamp(6)
  locations        location[]
  service_orders   ods[]

  @@map("cliente_final")
}

model configuracion {
  id_configuracion    Int                   @id @default(autoincrement())
  id_ods              Int
  parametros_tecnicos Json?
  archivo_config      String?               @db.VarChar(255)
  estado              estado_configuracion? @default(PENDIENTE)
  fecha_carga         DateTime?             @db.Timestamp(6)
  usuario_cargo       Int?
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  updated_at          DateTime?             @default(now()) @db.Timestamp(6)
  ods                 ods                   @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  usuario             usuario?              @relation(fields: [usuario_cargo], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}

model empleado {
  id_empleado         Int              @id @default(autoincrement())
  cedula              String           @unique @db.VarChar(20)
  nombre              String           @db.VarChar(100)
  apellido            String           @db.VarChar(100)
  fecha_nacimiento    DateTime?        @db.Date
  telefono            String?          @db.VarChar(50)
  email               String?          @db.VarChar(100)
  direccion           String?
  fecha_ingreso       DateTime         @db.Date
  cargo               String?          @db.VarChar(100)
  departamento        String?          @db.VarChar(100)
  tipo_contrato       String?          @db.VarChar(50)
  salario_base        Decimal?         @db.Decimal(12, 2)
  estado              estado_empleado? @default(ACTIVO)
  datos_bancarios     String?
  contacto_emergencia String?
  foto                String?          @db.VarChar(255)
  created_at          DateTime?        @default(now()) @db.Timestamp(6)
  updated_at          DateTime?        @default(now()) @db.Timestamp(6)
  tecnico             tecnico?
  usuario             usuario?
}

model equipo {
  id_equipo              Int                    @id @default(autoincrement())
  serial                 String                 @unique @db.VarChar(100)
  id_cliente_propietario Int
  id_tecnologia          Int?
  marca                  String?                @db.VarChar(100)
  modelo                 String?                @db.VarChar(100)
  estado_ciclo_vida      estado_equipo?         @default(ALMACEN)
  id_localidad_instalado Int?
  ubicacion_almacen      String?                @db.VarChar(100)
  condicion              condicion_equipo?      @default(NUEVO)
  fecha_recepcion        DateTime?              @default(now()) @db.Timestamp(6)
  observaciones          String?
  created_at             DateTime?              @default(now()) @db.Timestamp(6)
  updated_at             DateTime?              @default(now()) @db.Timestamp(6)
  client                 client                 @relation(fields: [id_cliente_propietario], references: [id], onDelete: NoAction, onUpdate: NoAction)
  location               location?              @relation(fields: [id_localidad_instalado], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tecnologia             tecnologia?            @relation(fields: [id_tecnologia], references: [id_tecnologia], onDelete: NoAction, onUpdate: NoAction)
  equipo_movimiento      equipo_movimiento[]
  nota_entrega_detalle   nota_entrega_detalle[]

  @@index([estado_ciclo_vida], map: "idx_equipo_estado")
  @@index([id_localidad_instalado], map: "idx_equipo_localidad")
  @@index([serial], map: "idx_equipo_serial")
}

model equipo_movimiento {
  id_movimiento       BigInt                 @id @default(autoincrement())
  id_equipo           Int
  id_ods              Int?
  tipo_movimiento     tipo_movimiento_equipo
  estado_anterior     String?                @db.VarChar(50)
  estado_nuevo        String                 @db.VarChar(50)
  fecha_movimiento    DateTime?              @default(now()) @db.Timestamp(6)
  usuario_responsable Int
  observaciones       String?
  equipo              equipo                 @relation(fields: [id_equipo], references: [id_equipo], onDelete: Cascade, onUpdate: NoAction)
  ods                 ods?                   @relation(fields: [id_ods], references: [id_ods], onDelete: NoAction, onUpdate: NoAction)
  usuario             usuario                @relation(fields: [usuario_responsable], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}

model factura {
  id_factura        Int             @id @default(autoincrement())
  numero_factura    String          @unique @db.VarChar(50)
  id_proforma       Int?
  id_cliente        Int
  fecha_emision     DateTime?       @default(dbgenerated("CURRENT_DATE")) @db.Date
  fecha_vencimiento DateTime?       @db.Date
  estado            estado_factura? @default(EMITIDA)
  base_imponible    Decimal         @db.Decimal(12, 2)
  impuestos         Decimal?        @default(0) @db.Decimal(12, 2)
  total             Decimal         @db.Decimal(12, 2)
  saldo_pendiente   Decimal?        @db.Decimal(12, 2)
  archivo_pdf       String?         @db.VarChar(255)
  created_at        DateTime?       @default(now()) @db.Timestamp(6)
  updated_at        DateTime?       @default(now()) @db.Timestamp(6)
  client            client          @relation(fields: [id_cliente], references: [id], onDelete: NoAction, onUpdate: NoAction)
  proforma          proforma?       @relation(fields: [id_proforma], references: [id_proforma], onDelete: NoAction, onUpdate: NoAction)
  pago              pago[]

  @@index([id_cliente], map: "idx_factura_cliente")
  @@index([estado], map: "idx_factura_estado")
  @@index([fecha_vencimiento], map: "idx_factura_vencimiento")
}

model herramienta {
  id_herramienta                Int                             @id @default(autoincrement())
  codigo_herramienta            String                          @unique @db.VarChar(50)
  nombre                        String                          @db.VarChar(200)
  descripcion                   String?
  categoria                     String?                         @db.VarChar(100)
  estado                        estado_herramienta?             @default(ALMACEN)
  condicion                     condicion_equipo?               @default(NUEVO)
  valor                         Decimal?                        @db.Decimal(12, 2)
  fecha_adquisicion             DateTime?                       @db.Date
  proveedor                     String?                         @db.VarChar(200)
  foto                          String?                         @db.VarChar(255)
  created_at                    DateTime?                       @default(now()) @db.Timestamp(6)
  updated_at                    DateTime?                       @default(now()) @db.Timestamp(6)
  solicitud_herramienta_detalle solicitud_herramienta_detalle[]
}

model informe_imagen {
  id_imagen          Int             @id @default(autoincrement())
  id_informe_tecnico Int
  archivo_imagen     String          @db.VarChar(255)
  descripcion        String?
  orden              Int?            @default(0)
  created_at         DateTime?       @default(now()) @db.Timestamp(6)
  informe_tecnico    informe_tecnico @relation(fields: [id_informe_tecnico], references: [id_informe_tecnico], onDelete: Cascade, onUpdate: NoAction)
}

model informe_servicio {
  id_informe_servicio Int       @id @default(autoincrement())
  id_ods              Int       @unique
  hora_inicio         DateTime? @db.Time(6)
  hora_fin            DateTime? @db.Time(6)
  trabajo_realizado   String?
  observaciones       String?
  firma_cliente       Bytes?
  archivo_escaneado   String?   @db.VarChar(255)
  fecha_carga         DateTime? @default(now()) @db.Timestamp(6)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)
  ods                 ods       @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
}

model informe_tecnico {
  id_informe_tecnico Int                  @id @default(autoincrement())
  id_ods             Int
  tipo_informe       tipo_informe_tecnico
  contenido          String
  fecha_creacion     DateTime?            @default(now()) @db.Timestamp(6)
  usuario_creador    Int
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  updated_at         DateTime?            @default(now()) @db.Timestamp(6)
  informe_imagen     informe_imagen[]
  ods                ods                  @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  usuario            usuario              @relation(fields: [usuario_creador], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model insumo {
  id_insumo           Int          @id @default(autoincrement())
  codigo_insumo       String       @unique @db.VarChar(50)
  nombre              String       @db.VarChar(200)
  descripcion         String?
  categoria           String?      @db.VarChar(100)
  unidad_medida       String?      @db.VarChar(50)
  stock_actual        Decimal?     @default(0) @db.Decimal(12, 3)
  stock_minimo        Decimal?     @default(0) @db.Decimal(12, 3)
  stock_maximo        Decimal?     @db.Decimal(12, 3)
  costo_unitario      Decimal?     @db.Decimal(12, 2)
  proveedor_principal String?      @db.VarChar(200)
  ubicacion_almacen   String?      @db.VarChar(100)
  foto                String?      @db.VarChar(255)
  created_at          DateTime?    @default(now()) @db.Timestamp(6)
  updated_at          DateTime?    @default(now()) @db.Timestamp(6)
  ods_insumo          ods_insumo[]
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model location {
  id                    Int              @id @default(autoincrement()) @map("id_localidad")
  end_customer_id       Int              @map("id_cliente_final")
  site_name             String           @map("nombre_sitio") @db.VarChar(200)
  full_address          String           @map("direccion_completa")
  gps_coordinates       String?          @map("coordenadas_gps") @db.VarChar(100)
  contact_person        String?          @map("persona_contacto") @db.VarChar(200)
  contact_phone         String?          @map("telefono_contacto") @db.VarChar(50)
  access_schedule       String?          @map("horario_acceso")
  access_restrictions   String?          @map("restricciones_permisos")
  notes                 String?          @map("observaciones")
  created_at            DateTime?        @default(now()) @db.Timestamp(6)
  updated_at            DateTime?        @default(now()) @db.Timestamp(6)
  equipment             equipo[]
  end_customer          end_customer     @relation(fields: [end_customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  service_orders        ods[]
  contacts              location_contact[]

  @@index([end_customer_id], map: "idx_localidad_cliente_final")
  @@map("localidad")
}

model location_contact {
  id           Int        @id @default(autoincrement()) @map("id_contacto")
  location_id  Int        @map("id_localidad")
  first_name   String     @map("nombre") @db.VarChar(100)
  last_name    String?    @map("apellido") @db.VarChar(100)
  position     String?    @map("cargo") @db.VarChar(100)
  phone        String?    @map("telefono") @db.VarChar(50)
  email        String?    @db.VarChar(100)
  is_primary   Boolean?   @default(false) @map("es_principal")
  created_at   DateTime?  @default(now()) @db.Timestamp(6)
  updated_at   DateTime?  @default(now()) @db.Timestamp(6)
  location     location   @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([location_id], map: "idx_localidad_contacto_localidad")
  @@map("localidad_contacto")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model modificacion_ods {
  id_modificacion                                    BigInt                @id @default(autoincrement())
  id_ods                                             Int
  id_transicion                                      Int?
  tipo_modificacion                                  tipo_modificacion_ods
  estado_anterior                                    String?               @db.VarChar(50)
  estado_nuevo                                       String?               @db.VarChar(50)
  justificacion                                      String
  requiere_aprobacion                                Boolean?              @default(false)
  aprobada                                           Boolean?
  usuario_solicita                                   Int
  usuario_aprueba                                    Int?
  fecha_solicitud                                    DateTime?             @default(now()) @db.Timestamp(6)
  fecha_aprobacion                                   DateTime?             @db.Timestamp(6)
  datos_adicionales                                  Json?
  created_at                                         DateTime?             @default(now()) @db.Timestamp(6)
  ods                                                ods                   @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  workflow_transicion                                workflow_transicion?  @relation(fields: [id_transicion], references: [id_transicion], onDelete: NoAction, onUpdate: NoAction)
  usuario_modificacion_ods_usuario_apruebaTousuario  usuario?              @relation("modificacion_ods_usuario_apruebaTousuario", fields: [usuario_aprueba], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  usuario_modificacion_ods_usuario_solicitaTousuario usuario               @relation("modificacion_ods_usuario_solicitaTousuario", fields: [usuario_solicita], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([id_ods], map: "idx_modificacion_ods")
}

model nota_entrega {
  id_nota_entrega      Int                    @id @default(autoincrement())
  numero_nota          String                 @unique @db.VarChar(50)
  id_ods               Int?
  tipo                 tipo_nota_entrega
  estado               estado_nota_entrega?   @default(PENDIENTE)
  transportista        String?                @db.VarChar(200)
  numero_guia          String?                @db.VarChar(100)
  fecha_despacho       DateTime?              @db.Timestamp(6)
  fecha_entrega        DateTime?              @db.Timestamp(6)
  firma_cliente        Bytes?
  observaciones        String?
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  ods                  ods?                   @relation(fields: [id_ods], references: [id_ods], onDelete: NoAction, onUpdate: NoAction)
  nota_entrega_detalle nota_entrega_detalle[]
}

model nota_entrega_detalle {
  id_detalle      Int          @id @default(autoincrement())
  id_nota_entrega Int
  id_equipo       Int
  condicion       String?      @db.VarChar(50)
  observaciones   String?
  equipo          equipo       @relation(fields: [id_equipo], references: [id_equipo], onDelete: NoAction, onUpdate: NoAction)
  nota_entrega    nota_entrega @relation(fields: [id_nota_entrega], references: [id_nota_entrega], onDelete: Cascade, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ods {
  id_ods                    Int                         @id @default(autoincrement())
  numero_ods                String                      @unique @db.VarChar(50)
  numero_orden_cliente      String                      @db.VarChar(100)
  id_cliente                Int
  id_cliente_final          Int
  id_localidad              Int
  id_tipo_servicio          Int
  estado_actual             String                      @db.VarChar(50)
  fecha_creacion            DateTime?                   @default(now()) @db.Timestamp(6)
  fecha_programada          DateTime?                   @db.Timestamp(6)
  fecha_ejecucion           DateTime?                   @db.Timestamp(6)
  fecha_culminacion         DateTime?                   @db.Timestamp(6)
  descripcion               String?
  diagnostico_inicial       String?
  observaciones             String?
  usuario_creador           Int
  prioridad                 prioridad_ods?              @default(NORMAL)
  created_at                DateTime?                   @default(now()) @db.Timestamp(6)
  updated_at                DateTime?                   @default(now()) @db.Timestamp(6)
  configuracion             configuracion[]
  equipo_movimiento         equipo_movimiento[]
  informe_servicio          informe_servicio?
  informe_tecnico           informe_tecnico[]
  modificacion_ods          modificacion_ods[]
  nota_entrega              nota_entrega[]
  end_customer              end_customer                @relation(fields: [id_cliente_final], references: [id], onDelete: NoAction, onUpdate: NoAction)
  client                    client                      @relation(fields: [id_cliente], references: [id], onDelete: NoAction, onUpdate: NoAction)
  location                  location                    @relation(fields: [id_localidad], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tipo_servicio             tipo_servicio               @relation(fields: [id_tipo_servicio], references: [id_tipo_servicio], onDelete: NoAction, onUpdate: NoAction)
  usuario                   usuario                     @relation(fields: [usuario_creador], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  ods_estado_historial      ods_estado_historial[]
  ods_insumo                ods_insumo[]
  ods_tecnico               ods_tecnico[]
  ods_tecnologia            ods_tecnologia[]
  proforma_detalle          proforma_detalle[]
  solicitud_herramienta_ods solicitud_herramienta_ods[]

  @@index([id_cliente], map: "idx_ods_cliente")
  @@index([estado_actual], map: "idx_ods_estado")
  @@index([fecha_programada], map: "idx_ods_fecha_programada")
  @@index([numero_orden_cliente], map: "idx_ods_numero_orden_cliente")
}

model ods_estado_historial {
  id_historial        BigInt    @id @default(autoincrement())
  id_ods              Int
  estado_anterior     String?   @db.VarChar(50)
  estado_nuevo        String    @db.VarChar(50)
  fecha_cambio        DateTime? @default(now()) @db.Timestamp(6)
  usuario_responsable Int
  observaciones       String?
  ods                 ods       @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  usuario             usuario   @relation(fields: [usuario_responsable], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_cambio(sort: Desc)], map: "idx_historial_fecha")
  @@index([id_ods], map: "idx_historial_ods")
}

model ods_insumo {
  id_asignacion     Int               @id @default(autoincrement())
  id_ods            Int
  id_insumo         Int
  cantidad_asignada Decimal           @db.Decimal(12, 3)
  cantidad_devuelta Decimal?          @default(0) @db.Decimal(12, 3)
  cantidad_usada    Decimal?          @default(0) @db.Decimal(12, 3)
  fecha_asignacion  DateTime?         @default(now()) @db.Timestamp(6)
  fecha_devolucion  DateTime?         @db.Timestamp(6)
  estado            estado_solicitud? @default(PENDIENTE)
  created_at        DateTime?         @default(now()) @db.Timestamp(6)
  updated_at        DateTime?         @default(now()) @db.Timestamp(6)
  insumo            insumo            @relation(fields: [id_insumo], references: [id_insumo], onDelete: NoAction, onUpdate: NoAction)
  ods               ods               @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)

  @@unique([id_ods, id_insumo])
}

model ods_tecnico {
  id_asignacion    Int       @id @default(autoincrement())
  id_ods           Int
  id_tecnico       Int
  rol              rol_ods?  @default(ASISTENTE)
  fecha_asignacion DateTime? @default(now()) @db.Timestamp(6)
  ods              ods       @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  tecnico          tecnico   @relation(fields: [id_tecnico], references: [id_tecnico], onDelete: NoAction, onUpdate: NoAction)

  @@unique([id_ods, id_tecnico])
}

model ods_tecnologia {
  id_ods           Int
  id_tecnologia    Int
  fecha_asignacion DateTime?  @default(now()) @db.Timestamp(6)
  ods              ods        @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  tecnologia       tecnologia @relation(fields: [id_tecnologia], references: [id_tecnologia], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_ods, id_tecnologia])
}

model pago {
  id_pago           Int       @id @default(autoincrement())
  id_factura        Int
  numero_referencia String    @unique @db.VarChar(100)
  fecha_pago        DateTime  @db.Date
  monto             Decimal   @db.Decimal(12, 2)
  metodo_pago       String?   @db.VarChar(50)
  banco             String?   @db.VarChar(100)
  comprobante       String?   @db.VarChar(255)
  usuario_registro  Int
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)
  factura           factura   @relation(fields: [id_factura], references: [id_factura], onDelete: Cascade, onUpdate: NoAction)
  usuario           usuario   @relation(fields: [usuario_registro], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}

model permiso {
  id_permiso    Int            @id @default(autoincrement())
  modulo        String         @db.VarChar(100)
  funcionalidad String         @db.VarChar(100)
  accion        accion_permiso
  descripcion   String?
  created_at    DateTime?      @default(now()) @db.Timestamp(6)
  rol_permiso   rol_permiso[]

  @@unique([modulo, funcionalidad, accion])
}

model proforma {
  id_proforma           Int                @id @default(autoincrement())
  numero_proforma       String             @unique @db.VarChar(50)
  id_cliente            Int
  fecha_emision         DateTime?          @default(dbgenerated("CURRENT_DATE")) @db.Date
  fecha_envio           DateTime?          @db.Date
  fecha_aprobacion      DateTime?          @db.Date
  estado                estado_proforma?   @default(BORRADOR)
  subtotal              Decimal?           @default(0) @db.Decimal(12, 2)
  impuestos             Decimal?           @default(0) @db.Decimal(12, 2)
  total                 Decimal?           @default(0) @db.Decimal(12, 2)
  observaciones_cliente String?
  archivo_pdf           String?            @db.VarChar(255)
  created_at            DateTime?          @default(now()) @db.Timestamp(6)
  updated_at            DateTime?          @default(now()) @db.Timestamp(6)
  factura               factura[]
  client                client             @relation(fields: [id_cliente], references: [id], onDelete: NoAction, onUpdate: NoAction)
  proforma_detalle      proforma_detalle[]
}

model proforma_detalle {
  id_detalle  Int      @id @default(autoincrement())
  id_proforma Int
  id_ods      Int
  descripcion String?
  monto       Decimal  @db.Decimal(12, 2)
  ods         ods      @relation(fields: [id_ods], references: [id_ods], onDelete: NoAction, onUpdate: NoAction)
  proforma    proforma @relation(fields: [id_proforma], references: [id_proforma], onDelete: Cascade, onUpdate: NoAction)

  @@unique([id_proforma, id_ods])
}

model regla_transicion {
  id_regla            Int                   @id @default(autoincrement())
  id_transicion       Int
  tipo_regla          tipo_regla_transicion
  condicion           Json
  mensaje_error       String?
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  updated_at          DateTime?             @default(now()) @db.Timestamp(6)
  workflow_transicion workflow_transicion   @relation(fields: [id_transicion], references: [id_transicion], onDelete: Cascade, onUpdate: NoAction)
}

model rol {
  id_rol      Int           @id @default(autoincrement())
  nombre_rol  String        @unique @db.VarChar(100)
  descripcion String?
  created_at  DateTime?     @default(now()) @db.Timestamp(6)
  updated_at  DateTime?     @default(now()) @db.Timestamp(6)
  rol_permiso rol_permiso[]
  usuario_rol usuario_rol[]
}

model rol_permiso {
  id_rol           Int
  id_permiso       Int
  fecha_asignacion DateTime? @default(now()) @db.Timestamp(6)
  permiso          permiso   @relation(fields: [id_permiso], references: [id_permiso], onDelete: Cascade, onUpdate: NoAction)
  rol              rol       @relation(fields: [id_rol], references: [id_rol], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_rol, id_permiso])
}

model solicitud_herramienta {
  id_solicitud_herramienta      Int                             @id @default(autoincrement())
  id_tecnico                    Int
  estado                        estado_solicitud?               @default(PENDIENTE)
  fecha_solicitud               DateTime?                       @default(now()) @db.Timestamp(6)
  fecha_requerida               DateTime?                       @db.Timestamp(6)
  fecha_entrega                 DateTime?                       @db.Timestamp(6)
  fecha_devolucion              DateTime?                       @db.Timestamp(6)
  observaciones                 String?
  created_at                    DateTime?                       @default(now()) @db.Timestamp(6)
  updated_at                    DateTime?                       @default(now()) @db.Timestamp(6)
  tecnico                       tecnico                         @relation(fields: [id_tecnico], references: [id_tecnico], onDelete: NoAction, onUpdate: NoAction)
  solicitud_herramienta_detalle solicitud_herramienta_detalle[]
  solicitud_herramienta_ods     solicitud_herramienta_ods[]
}

model solicitud_herramienta_detalle {
  id_detalle               Int                   @id @default(autoincrement())
  id_solicitud_herramienta Int
  id_herramienta           Int
  cantidad                 Int                   @default(1)
  herramienta              herramienta           @relation(fields: [id_herramienta], references: [id_herramienta], onDelete: NoAction, onUpdate: NoAction)
  solicitud_herramienta    solicitud_herramienta @relation(fields: [id_solicitud_herramienta], references: [id_solicitud_herramienta], onDelete: Cascade, onUpdate: NoAction)

  @@unique([id_solicitud_herramienta, id_herramienta])
}

model solicitud_herramienta_ods {
  id_solicitud_herramienta Int
  id_ods                   Int
  ods                      ods                   @relation(fields: [id_ods], references: [id_ods], onDelete: Cascade, onUpdate: NoAction)
  solicitud_herramienta    solicitud_herramienta @relation(fields: [id_solicitud_herramienta], references: [id_solicitud_herramienta], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_solicitud_herramienta, id_ods])
}

model tecnico {
  id_tecnico            Int                     @id @default(autoincrement())
  id_empleado           Int                     @unique
  especialidades        Json?
  disponible            Boolean?                @default(true)
  nivel                 nivel_tecnico?          @default(JUNIOR)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  updated_at            DateTime?               @default(now()) @db.Timestamp(6)
  ods_tecnico           ods_tecnico[]
  solicitud_herramienta solicitud_herramienta[]
  empleado              empleado                @relation(fields: [id_empleado], references: [id_empleado], onDelete: NoAction, onUpdate: NoAction)
}

model tecnologia {
  id_tecnologia    Int              @id @default(autoincrement())
  categoria        String           @db.VarChar(100)
  subcategoria     String?          @db.VarChar(100)
  marca            String?          @db.VarChar(100)
  modelo           String?          @db.VarChar(100)
  especificaciones String?
  created_at       DateTime?        @default(now()) @db.Timestamp(6)
  updated_at       DateTime?        @default(now()) @db.Timestamp(6)
  equipo           equipo[]
  ods_tecnologia   ods_tecnologia[]
}

model tipo_servicio {
  id_tipo_servicio      Int                   @id @default(autoincrement())
  nombre                String                @unique @db.VarChar(100)
  descripcion           String?
  requiere_informe_post Boolean?              @default(false)
  sla_dias              Int?
  created_at            DateTime?             @default(now()) @db.Timestamp(6)
  updated_at            DateTime?             @default(now()) @db.Timestamp(6)
  ods                   ods[]
  workflow_definicion   workflow_definicion[]
}

model usuario {
  id_usuario                                                  Int                    @id @default(autoincrement())
  id_empleado                                                 Int?                   @unique
  username                                                    String                 @unique @db.VarChar(50)
  password_hash                                               String                 @db.VarChar(255)
  email                                                       String                 @unique @db.VarChar(100)
  estado                                                      estado_usuario?        @default(ACTIVO)
  fecha_ultimo_acceso                                         DateTime?              @db.Timestamp(6)
  intentos_fallidos                                           Int?                   @default(0)
  foto_perfil                                                 String?                @db.VarChar(255)
  created_at                                                  DateTime?              @default(now()) @db.Timestamp(6)
  updated_at                                                  DateTime?              @default(now()) @db.Timestamp(6)
  auditoria                                                   auditoria[]
  configuracion                                               configuracion[]
  equipo_movimiento                                           equipo_movimiento[]
  informe_tecnico                                             informe_tecnico[]
  modificacion_ods_modificacion_ods_usuario_apruebaTousuario  modificacion_ods[]     @relation("modificacion_ods_usuario_apruebaTousuario")
  modificacion_ods_modificacion_ods_usuario_solicitaTousuario modificacion_ods[]     @relation("modificacion_ods_usuario_solicitaTousuario")
  ods                                                         ods[]
  ods_estado_historial                                        ods_estado_historial[]
  pago                                                        pago[]
  empleado                                                    empleado?              @relation(fields: [id_empleado], references: [id_empleado], onDelete: NoAction, onUpdate: NoAction)
  usuario_rol                                                 usuario_rol[]
}

model usuario_rol {
  id_usuario       Int
  id_rol           Int
  fecha_asignacion DateTime? @default(now()) @db.Timestamp(6)
  rol              rol       @relation(fields: [id_rol], references: [id_rol], onDelete: Cascade, onUpdate: NoAction)
  usuario          usuario   @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_usuario, id_rol])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workflow_definicion {
  id_workflow         Int                   @id @default(autoincrement())
  id_tipo_servicio    Int
  nombre              String                @db.VarChar(200)
  descripcion         String?
  version             Int?                  @default(1)
  activo              Boolean?              @default(true)
  fecha_creacion      DateTime?             @default(now()) @db.Timestamp(6)
  created_at          DateTime?             @default(now()) @db.Timestamp(6)
  updated_at          DateTime?             @default(now()) @db.Timestamp(6)
  tipo_servicio       tipo_servicio         @relation(fields: [id_tipo_servicio], references: [id_tipo_servicio], onDelete: NoAction, onUpdate: NoAction)
  workflow_estado     workflow_estado[]
  workflow_transicion workflow_transicion[]

  @@unique([id_tipo_servicio, version])
}

model workflow_estado {
  id_estado                                                                  Int                   @id @default(autoincrement())
  id_workflow                                                                Int
  codigo_estado                                                              String                @db.VarChar(50)
  nombre_estado                                                              String                @db.VarChar(100)
  descripcion                                                                String?
  es_estado_inicial                                                          Boolean?              @default(false)
  es_estado_final                                                            Boolean?              @default(false)
  color                                                                      String?               @db.VarChar(20)
  orden                                                                      Int?
  created_at                                                                 DateTime?             @default(now()) @db.Timestamp(6)
  updated_at                                                                 DateTime?             @default(now()) @db.Timestamp(6)
  workflow_definicion                                                        workflow_definicion   @relation(fields: [id_workflow], references: [id_workflow], onDelete: Cascade, onUpdate: NoAction)
  workflow_transicion_workflow_transicion_id_estado_destinoToworkflow_estado workflow_transicion[] @relation("workflow_transicion_id_estado_destinoToworkflow_estado")
  workflow_transicion_workflow_transicion_id_estado_origenToworkflow_estado  workflow_transicion[] @relation("workflow_transicion_id_estado_origenToworkflow_estado")

  @@unique([id_workflow, codigo_estado])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workflow_transicion {
  id_transicion                                                          Int                 @id @default(autoincrement())
  id_workflow                                                            Int
  id_estado_origen                                                       Int
  id_estado_destino                                                      Int
  nombre_accion                                                          String              @db.VarChar(100)
  requiere_aprobacion                                                    Boolean?            @default(false)
  requiere_justificacion                                                 Boolean?            @default(false)
  validaciones                                                           Json?
  created_at                                                             DateTime?           @default(now()) @db.Timestamp(6)
  updated_at                                                             DateTime?           @default(now()) @db.Timestamp(6)
  modificacion_ods                                                       modificacion_ods[]
  regla_transicion                                                       regla_transicion[]
  workflow_estado_workflow_transicion_id_estado_destinoToworkflow_estado workflow_estado     @relation("workflow_transicion_id_estado_destinoToworkflow_estado", fields: [id_estado_destino], references: [id_estado], onDelete: NoAction, onUpdate: NoAction)
  workflow_estado_workflow_transicion_id_estado_origenToworkflow_estado  workflow_estado     @relation("workflow_transicion_id_estado_origenToworkflow_estado", fields: [id_estado_origen], references: [id_estado], onDelete: NoAction, onUpdate: NoAction)
  workflow_definicion                                                    workflow_definicion @relation(fields: [id_workflow], references: [id_workflow], onDelete: Cascade, onUpdate: NoAction)

  @@unique([id_workflow, id_estado_origen, id_estado_destino])
}

enum accion_permiso {
  CREAR
  LEER
  ACTUALIZAR
  ELIMINAR
  EJECUTAR
}

enum condicion_equipo {
  NUEVO
  USADO_BUENO
  USADO_REGULAR
  DEFECTUOSO
}

enum client_status {
  ACTIVE     @map("ACTIVO")
  INACTIVE   @map("INACTIVO")
  SUSPENDED  @map("SUSPENDIDO")

  @@map("estado_cliente")
}

enum estado_configuracion {
  PENDIENTE
  CARGADA
  APLICADA
  RECHAZADA
}

enum estado_empleado {
  ACTIVO
  VACACIONES
  REPOSO
  SUSPENDIDO
  RETIRADO
}

enum estado_equipo {
  ALMACEN
  TRANSITO
  INSTALADO
  PENDIENTE_NOTA_ENTREGA
  ENTREGADO
  BAJA
}

enum estado_factura {
  EMITIDA
  ENVIADA
  PAGADA_PARCIAL
  PAGADA_TOTAL
  VENCIDA
  ANULADA
}

enum estado_herramienta {
  ALMACEN
  TRASLADO
  MANTENIMIENTO
  BAJA
}

enum estado_nota_entrega {
  PENDIENTE
  EN_TRANSITO
  ENTREGADA
  RECHAZADA
  CANCELADA
}

enum estado_proforma {
  BORRADOR
  ENVIADA
  APROBADA
  RECHAZADA
  VENCIDA
}

enum estado_solicitud {
  PENDIENTE
  APROBADA
  ENTREGADA
  DEVUELTA
  PARCIALMENTE_DEVUELTA
  RECHAZADA
  CANCELADA
}

enum estado_usuario {
  ACTIVO
  INACTIVO
  BLOQUEADO
}

enum nivel_tecnico {
  JUNIOR
  SEMI_SENIOR
  SENIOR
  ESPECIALISTA
}

enum prioridad_ods {
  NORMAL
  ALTA
  URGENTE
}

enum rol_ods {
  PRINCIPAL
  ASISTENTE
  SUPERVISOR
}

enum tipo_informe_tecnico {
  INSPECCION
  POST_INSTALACION
  POST_MANTENIMIENTO
  CORRECTIVO
}

enum tipo_modificacion_ods {
  CAMBIO_ESTADO
  CAMBIO_ALCANCE
  PAUSA
  REPROGRAMACION
  CANCELACION
  REACTIVACION
}

enum tipo_movimiento_equipo {
  RECEPCION
  ASIGNACION_ODS
  INSTALACION
  DESINSTALACION
  DEVOLUCION
  BAJA
}

enum tipo_nota_entrega {
  ENTREGA_CLIENTE
  DEVOLUCION_CLIENTE
}

enum tipo_regla_transicion {
  VALIDACION_CAMPO
  VALIDACION_RECURSO
  VALIDACION_PERMISO
  VALIDACION_NEGOCIO
  VALIDACION_TEMPORAL
}
