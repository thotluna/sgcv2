
> frontend@0.4.0 test /home/thot/proyects/sgcv2/frontend
> jest

PASS app/(core)/users/_components/__tests__/actions.test.ts
PASS lib/api/__tests__/server-users.service.test.ts
PASS stores/__tests__/auth.store.test.ts (7.688 s)
  ● Console

    console.error
      Login failed: Error: Invalid credentials
          at Object.<anonymous> (/home/thot/proyects/sgcv2/frontend/stores/__tests__/auth.store.test.ts:66:25)
          at Promise.finally.completed (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-runner@30.2.0/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-runner@30.2.0/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-runner@30.2.0/node_modules/jest-runner/build/testWorker.js:497:12)

      42 |           set({ user, isAuthenticated: true });
      43 |         } catch (error) {
    > 44 |           console.error('Login failed:', error);
         |                   ^
      45 |           set({ user: null, isAuthenticated: false });
      46 |           throw error;
      47 |         }

      at Object.error (stores/auth.store.ts:44:19)
      at stores/__tests__/auth.store.test.ts:73:11

    console.error
      Auth check failed: Error: Unauthorized
          at Object.<anonymous> (/home/thot/proyects/sgcv2/frontend/stores/__tests__/auth.store.test.ts:175:59)
          at Promise.finally.completed (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-circus@30.2.0/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-runner@30.2.0/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-runner@30.2.0/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/home/thot/proyects/sgcv2/node_modules/.pnpm/jest-runner@30.2.0/node_modules/jest-runner/build/testWorker.js:497:12)

      80 |           set({ user, isAuthenticated: true });
      81 |         } catch (error) {
    > 82 |           console.error('Auth check failed:', error);
         |                   ^
      83 |           set({ user: null, isAuthenticated: false });
      84 |         }
      85 |       },

      at Object.error [as checkAuth] (stores/auth.store.ts:82:19)
      at stores/__tests__/auth.store.test.ts:180:9

PASS app/(core)/users/profile/_actions/__tests__/profile.actions.test.ts (6.92 s)
PASS app/(core)/operations/customers/__tests__/view.test.tsx (9.977 s)
PASS app/(core)/operations/customers/_components/__tests__/table.test.tsx
PASS app/(core)/permissions/__tests__/page.test.tsx
PASS app/(core)/users/profile/_schemas/__tests__/profile.schema.test.ts
PASS app/(core)/permissions/_components/__tests__/permissions-table.test.tsx
PASS hooks/__tests__/use-auth.test.ts
  ● Console

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Reflect.set (<anonymous>)
          at Object.<anonymous> (hooks/__tests__/use-auth.test.ts:19:20)
          at new Promise (<anonymous>) {
        type: 'not implemented'
      }

      17 |     // @ts-ignore
      18 |     delete window.location;
    > 19 |     window.location = { href: '' } as any;
         |                    ^
      20 |   });
      21 |
      22 |   afterAll(() => {

      at VirtualConsole.<anonymous> (../node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at module.exports (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
          at Reflect.set (<anonymous>)
      at Window.set location [as location] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/browser/Window.js:424:15)
      at Object.<anonymous> (hooks/__tests__/use-auth.test.ts:19:20)

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Object.login (hooks/use-auth.ts:17:27)
          at <unknown> (hooks/__tests__/use-auth.test.ts:46:9) {
        type: 'not implemented'
      }

      15 |       await storeLogin(username, password);
      16 |       // Force a hard navigation to ensure cookies are sent internally and middleware recognizes the session
    > 17 |       window.location.href = '/dashboard';
         |                           ^
      18 |     },
      19 |     [storeLogin]
      20 |   );

      at VirtualConsole.<anonymous> (../node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at module.exports (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
      at Object.login (hooks/use-auth.ts:17:27)
      at hooks/__tests__/use-auth.test.ts:46:9

    console.error
      Error: Not implemented: navigation (except hash changes)
          at Object.logout (hooks/use-auth.ts:24:25)
          at <unknown> (hooks/__tests__/use-auth.test.ts:75:9) {
        type: 'not implemented'
      }

      22 |   const logout = useCallback(async () => {
      23 |     await storeLogout();
    > 24 |     window.location.href = '/login';
         |                         ^
      25 |   }, [storeLogout]);
      26 |
      27 |   return {

      at VirtualConsole.<anonymous> (../node_modules/.pnpm/@jest+environment-jsdom-abstract@30.2.0_jsdom@26.1.0/node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at module.exports (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at LocationImpl._locationObjectNavigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:30:5)
      at LocationImpl._locationObjectSetterNavigate (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:24:17)
      at LocationImpl.set href [as href] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/window/Location-impl.js:46:10)
      at Location.set href [as href] (../node_modules/.pnpm/jsdom@26.1.0/node_modules/jsdom/lib/jsdom/living/generated/Location.js:125:37)
      at Object.logout (hooks/use-auth.ts:24:25)
      at hooks/__tests__/use-auth.test.ts:75:9

PASS lib/api/__tests__/server-roles.service.test.ts
PASS app/(core)/operations/customers/_components/__tests__/form.test.tsx (7.655 s)
  ● Console

    console.error
      A suspended resource finished loading inside a test, but the event was not wrapped in act(...).
      
      When testing, code that resolves suspended data should be wrapped into act(...):
      
      act(() => {
        /* finish loading suspended data */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      at pingSuspendedRoot (../node_modules/.pnpm/react-dom@19.2.0_react@19.2.0/node_modules/react-dom/cjs/react-dom-client.development.js:18600:17)
      at pingEngtangledActionScope (../node_modules/.pnpm/react-dom@19.2.0_react@19.2.0/node_modules/react-dom/cjs/react-dom-client.development.js:5870:69)

PASS app/(core)/operations/customers/__tests__/update.test.tsx
FAIL app/(core)/operations/customers/__tests__/new.test.tsx
  ● Test suite failed to run

    ReferenceError: TextEncoder is not defined

      18 | export async function createCustomerAction(_prevState: ActionState, formData: FormData): Promise<ActionState> {
      19 |   // Extract data from FormData
    > 20 |   const rawData = Object.fromEntries(formData.entries());
         |                ^
      21 |
      22 |   // Validate with Zod
      23 |   const validatedFields = createSchema.safeParse(rawData);

      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/src/server/stream-utils/node-web-streams-helper.ts:31:17)
      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/dist/server/render-result.js:11:31)
      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/dist/server/response-cache/utils.js:28:62)
      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/dist/server/response-cache/index.js:14:16)
      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/dist/server/lib/patch-fetch.js:42:24)
      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/dist/server/web/spec-extension/unstable-cache.js:12:21)
      at Object.<anonymous> (../node_modules/.pnpm/next@16.0.7_@babel+core@7.28.6_@playwright+test@1.58.0_babel-plugin-react-compiler@1.0._0f3d1462eee32f691a32375abbfeb3de/node_modules/next/cache.js:2:19)
      at Object.<anonymous> (/home/thot/proyects/sgcv2/frontend/app/(core)../../../../../operations/customers/_components/actions.ts:20:16)
      at Object.<anonymous> (/home/thot/proyects/sgcv2/frontend/app/(core)../../../../../operations/customers/new/page.tsx:16:18)
      at Object.<anonymous> (/home/thot/proyects/sgcv2/frontend/app/(core)../../../../../operations/customers/__tests__/new.test.tsx:52:54)

PASS app/(core)/operations/customers/__tests__/page.test.tsx (12.944 s)
PASS app/(auth)/login/__tests__/page.test.tsx (13.821 s)

Test Suites: 1 failed, 15 passed, 16 total
Tests:       90 passed, 90 total
Snapshots:   0 total
Time:        23.136 s
Ran all test suites.
 ERR_PNPM_RECURSIVE_RUN_FIRST_FAIL  frontend@0.4.0 test: `jest`
Exit status 1
